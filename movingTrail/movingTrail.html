<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>运动轨迹</title>
    <style>
        body{
            margin: 0;
            padding: 0;
            height: 100%;
        }
        .wrapper{
            width: 80%;
            padding: 20px 0;
            margin: 0px auto;

        }
        #container{
            width: 80%;
            min-width: 400px;
            height: 400px;
            margin: 50px auto;
        }
    </style>
</head>
<body style="height: 100%; margin: 0">
    
    <!-- 上传Excel表格-->
    <div class="wrapper">
        <h3>请选择要上传的excel文件</h3>
        <input type="file" onchange="importExcel(this)" />
        <p class="info"></p>
    </div>
    
    
    <!-- ECharts 图标显示容器 -->
    <div id="container"></div>
    
    <!-- 引入需要的js -->
    <script type="text/javascript" src="jquery-3.3.1.js"></script> <!-- jQuery -->
    <script src="http://oss.sheetjs.com/js-xlsx/xlsx.full.min.js"></script> <!-- SheetJS的js-xlsx -->
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script> <!-- ECharts -->

    <script type="text/javascript">
        /*
            FileReader共有4种读取方法：
            1.readAsArrayBuffer(file)：将文件读取为ArrayBuffer。
            2.readAsBinaryString(file)：将文件读取为二进制字符串
            3.readAsDataURL(file)：将文件读取为Data URL
            4.readAsText(file, [encoding])：将文件读取为文本，encoding缺省值为'UTF-8'

        */
    var wb;//读取完成的数据
    var rABS = false; //是否将文件读取为二进制字符串
    var dataUnit=[];

    function importExcel(obj) {//导入

        // 判断是否有文件
        if(!obj.files) {
            return;
        }

        const IMPORTFILE_MAXSIZE = 1*1024;// 定义导入文件大小

        var suffix = obj.files[0].name.split(".")[1]; // 截取后缀名

        // 判断文件格式是否正确
        if(suffix != 'xls' && suffix !='xlsx'){
            alert('导入的文件格式不正确!');
            return;
        }

        // 判断文件大小是否超过限制
        if(obj.files[0].size/1024 > IMPORTFILE_MAXSIZE){
            alert('导入的表格文件不能大于1M');
            return;
        }

        var f = obj.files[0];
        var reader = new FileReader();  // h5提供的File API
        var info = document.getElementsByClassName('info');
        
        // FileReader最有用的三个事件：progress、error和load.
        // progress: 是否又读取了新数据
        // error：是否发生了错误
        reader.onerror = function(){
            info.innerHTML = "读取文件失败，请重试！";
        };

        // load: 是否读完了整个文件
        reader.onload = function(e) {
            var data = e.target.result;
            if(rABS) {
                wb = XLSX.read(btoa(fixdata(data)), {//手动转化
                    type: 'base64'
                });
            } else {
                wb = XLSX.read(data, {
                    type: 'binary'
                });
            }

            var sheetName = wb.SheetNames[0]; //是获取Sheets中第一个Sheet的名字
            var sheetData = wb.Sheets[sheetName]; //获取第一个Sheet的数据

            // 将表数据转换为JSON
            var dataJSON = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
            var oddY=[],evenX=[];
            
            // 提取并处理需要的数据
            for (var i = 0; i < dataJSON.length; i++) {
                if(i % 2 === 0) {
                   evenX.push(dataJSON[i].r.substring(2,dataJSON[i].r.length-2)); 
                } else {
                    oddY.push(dataJSON[i].r.substring(2,dataJSON[i].r.length-2));
                }
            }
            
            // 转换为ECharts需要的数组
            for (var i = 0; i < (evenX.length > oddY.length?evenX.length:oddY.length); i++) {
                dataUnit[i] = [evenX[i],oddY[i]];
            }
            
            // 渲染成表格
            renderChart(dataUnit);
        };
        if(rABS) {
            reader.readAsArrayBuffer(f);
        } else {
            reader.readAsBinaryString(f);
        }
    }

    function fixdata(data) { //文件流转BinaryString
        var o = "",
            l = 0,
            w = 10240;
        for(; l < data.byteLength / w; ++l) o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w, l * w + w)));
        o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w)));
        return o;
    }

    function renderChart(dataUnit){
        var dom = document.getElementById("container");
        var myChart = echarts.init(dom);
        var option = {
            title: {
                text: '运动轨迹'
            },
            tooltip: {},
            legend: {
                data:['运动轨迹']
            },
            xAxis: { // X轴数据(根据系列的data值)
                name:'cm',
                type: 'value'
            },
            yAxis: { // y轴数据(根据系列的data值)
                name:'cm',
                type: 'value'
            },
            series: [{ // 通过使用 series[i] 来表示系列列表
                name: '运动轨迹',
                type: 'scatter', // 表示散点图类型
                smooth: true, // 曲线平滑
                coordinateSystem: 'cartesian2d',// 直角坐标系
                data: dataUnit, // 描述的数据
                animationDelay: function (idx) {
                    return idx * 100;
                }
            }]
        };

        if (option && typeof option === "object") {
            myChart.setOption(option, true);
        }

    }

    </script>
</body>
</html>